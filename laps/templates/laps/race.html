{% include "laps/header.html" %}

{% load lap_extras %}

<h1>
	<span class="glyphicon glyphicon-flag" aria-hidden="true"></span>
	{{ race.name }} with {{ race.organization }}
	{% if user.is_authenticated %}
		<small><a href="{% url 'laps:edit_race' race.id %}">[ Edit ]</a></small>
	{% endif %}
</h1>
<div class="row">
	<div class="col-md-3 col-md-offset-1">
		<h3>{{ race.date_time }}</h3>
	</div>
	<div class="col-md-4">
		<h3>
			<span class="glyphicon glyphicon-road" aria-hidden="true"></span>
			<a href="{% url 'laps:track' racer race.track.id %}">{{ race.track.name }}</a>
		</h3>
	</div>
	<div class="col-md-4">
		<h3>
			<a href="{% url 'laps:machine' racer race.machine_config.machine.id %}">{{ race.machine_config.machine.name }}</a>
		</h3>
	</div>
</div>
{% if race.conditions %}
	<div class="row">
		<div class="col-md-4 col-md-offset-4">
			<p class="text-warning">Conditions: {{ race.conditions }}</p>
		</div>
	</div>
{% endif %}

<div class="panel panel-default">
	<div class="panel-heading">Lap Plot</div>
	{% include "laps/race_chart_laps.html" %}
	<div id="container" style="width:100%; height:300px;"></div>
</div>

<div class="row">
	<div class="col-md-6">
		<div class="panel panel-default">
			<div class="panel-heading">Laps</div>
			<table class="table table-striped table-hover">
			{% for lap in race.laps.all %}
				{% if race.best_lap_time == lap.time %}
					<tr class="success">
				{% else %}
					<tr>
				{% endif %}
					<td>{{ lap.num }}</td>
			    	<td>{{ lap.time|format_lap_time }}</td>
			    </tr>
			{% endfor %}
			</table>
		</div>
	</div>
	<div class="col-md-6">
		<div class="panel panel-default">
			<div class="panel-heading">
				<span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
				Configuration
			</div>
			<table class="table">
			{% for attr in race.machine_config.attributes.values %}
				<tr>
					<td><strong>{{ attr.key }}</strong></td>
					<td>{{ attr.value }}</td>
				</tr>
			{% endfor %}
			{% if add_config_attr_form %}
				<tr>
					<form action="/laps/races/{{race.id}}/edit/add_config_attr" method="post">
						{% csrf_token %}
						<td>{{add_config_attr_form.key}}</td>
						<td>{{add_config_attr_form.value}} <input type="submit" value="Add" /></td>
					</form>
				</tr>
			{% endif %}
			</table>
		</div>
	</div>
</div>

{% include "laps/footer.html" %}